<div *ngIf="hasDataLoaded; then dataLoaded;else dataNotLoaded"></div>
<ng-template #dataLoaded>
	<div *ngIf="previewLink; then hasPreviewLink; else noPreviewLink">
	</div>
	<ng-template #hasPreviewLink>
		<div class="row text-center" *ngIf="transactionDetails == null;else hasTxDetails">
			<div *ngIf="shouldSendToBlockchain">
				<div *ngIf="userIsSellerBroker;else notSellerBroker">
					<i>Status: Waiting For You To Record The Purchase Agreement To The Blockchain. Please use the button
						below!</i>
					<br>
					<app-record-blockchain-form [recordButtonEnabled]="recordButtonEnabled"
												(onRecord)="onRecordClick($event)"></app-record-blockchain-form>
				</div>
			</div>
		</div>
		<ng-template #hasTxDetails>
			<div *ngIf="transactionDetails.status == TRANSACTION_STATUSES.SUCCESS; else notSuccessfulTx">
				<i>Action successfully recorded to the Blockchain. Here is your receipt:</i>
				<a [href]="transactionDetails.url" target="_blank">{{transactionDetails.url}}</a>
			</div>
			<ng-template #notSuccessfulTx>
				<div *ngIf="userIsSellerBroker;else notSellerBroker">
					<div *ngIf="transactionDetails.status == TRANSACTION_STATUSES.PENDING">
						<i>Your action is being recorded to the Blockchain. To check the current status, please follow
							the link below.</i>
						<a [href]="transactionDetails.url" target="_blank">{{transactionDetails.url}}</a>
					</div>
					<div *ngIf="transactionDetails.status == TRANSACTION_STATUSES.FAILED">
						<i>Your Blockchain action was not successfully recorded. Please try again. Here is your
							receipt:</i>
						<a [href]="transactionDetails.url" target="_blank">{{transactionDetails.url}}</a>
						<br>
						<app-record-blockchain-form [recordButtonEnabled]="recordButtonEnabled"
													(onRecord)="onRecordClick($event)"></app-record-blockchain-form>
					</div>
				</div>
			</ng-template>
		</ng-template>
		<ng-template #notSellerBroker>
			<i>Status: Waiting for Seller Broker To Record The Purchase Agreement To The Blockchain</i>
		</ng-template>
		<div class="row">
			<div class="col-xs-12">
				<hr>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-12">
				<div class="row" *ngIf="userIsSellerBroker">
					<div class="col-xs-12 reupload-holder" *ngIf="deed.status < deedStatus.purchaseAgreement">
						<div class="row reupload-button-holder">
							<div class="col-xs-12">
								<button type="button" *ngIf="!reuploadingDocumentActivated"
										class="btn propy-control button-big pull-right"
										(click)="reuploadingDocumentActivated = true">Reupload
								</button>
								<button type="button" *ngIf="reuploadingDocumentActivated"
										class="btn propy-control cancel-reuploading button-big btn-white pull-right"
										(click)="reuploadingDocumentActivated = false">Cancel reuploading
								</button>
							</div>
						</div>
						<div class="row" *ngIf="reuploadingDocumentActivated">
							<div class="col-xs-12">
								<app-upload-document [uploadTitle]="purchaseTitle"
													 [uploadSubtitle]="uploadPurchaseSubtitle"
													 (onUploadDocumentApplied)="uploadDocument($event)"></app-upload-document>
							</div>
						</div>
					</div>
				</div>
				<div class="row"
					 *ngIf="hasBuyerSigned && hasSellerSigned && hasBuyerBrokerSigned && hasSellerBrokerSigned; then allSigned; else notAllSigned">

				</div>
				<ng-template #notAllSigned>
					<div class="col-xs-12 text-center" *ngIf="!reuploadingDocumentActivated && !userIsTitleCompany">
						<app-document-preview [previewTitle]="purchaseTitle" [previewSubtitle]="previewPurchaseSubtitle"
											  [previewLink]="previewLink"
											  [showSignatureDelayNotes]="shouldShowSignatureDelayNotes"></app-document-preview>
					</div>
					<div class="col-xs-12 text-center" *ngIf="!reuploadingDocumentActivated && userIsTitleCompany">
						<app-document-preview [previewTitle]="purchaseTitle"
											  [previewSubtitle]="previewPurchaseSubtitleEscrow"
											  [previewLink]="previewLink"
											  [showSignatureDelayNotes]="shouldShowSignatureDelayNotes"></app-document-preview>
					</div>
				</ng-template>
				<ng-template #allSigned>
					<div class="col-xs-12 text-center" *ngIf="!reuploadingDocumentActivated && !userIsTitleCompany">
						<app-document-preview [previewTitle]="purchaseTitle" [previewLink]="previewLink"
											  [showSignatureDelayNotes]="shouldShowSignatureDelayNotes"></app-document-preview>
					</div>
				</ng-template>
			</div>
		</div>
		<div class="row" *ngIf="!reuploadingDocumentActivated">
			<div class="col-xs-12 text-center">
				<app-sign-document [hasBuyerSigned]="hasBuyerSigned" [hasSellerSigned]="hasSellerSigned"
								   [hasBuyerBrokerSigned]="hasBuyerBrokerSigned "
								   [hasSellerBrokerSigned]="hasSellerBrokerSigned "
								   [showSignButton]="shouldShowSignButton()"
								   [disableSignButton]="shouldShowSignatureDelayNotes"
								   [documentType]="deedDocumentTypeEnum.PurchaseAgreement "
								   (onSignDocument)="signDocument() "></app-sign-document>
			</div>
		</div>
	</ng-template>

	<ng-template #noPreviewLink>
		<div class="row " *ngIf="userIsSellerBroker; then isBroker; else isNotBroker ">
		</div>

		<ng-template #isBroker>
			<div class="col-xs-12 text-center">
				<app-upload-document [uploadTitle]="purchaseTitle" [uploadSubtitle]="uploadPurchaseSubtitle"
									 (onUploadDocumentApplied)="uploadDocument($event)"></app-upload-document>
			</div>
		</ng-template>

		<ng-template #isNotBroker>
			<div class="col-xs-12 text-center ">
				<h5>Waiting for seller broker to upload purchase agreement</h5>
			</div>
		</ng-template>

	</ng-template>
</ng-template>
<ng-template #dataNotLoaded>
	<h4>Loading...</h4>
</ng-template>
